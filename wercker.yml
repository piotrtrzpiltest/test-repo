box: ingensi/play-framework:2.3.8
#
#initial-build:
#  steps:
#    - script:
#      name: install deps
#      code: |
#        yum makecache fast && yum -y install tar
#
#        yum makecache fast && \
#        yum -y install tar && \
dev:
  steps:
    - script:
      name: build release
      code: |
        curl -s https://raw.githubusercontent.com/paulp/sbt-extras/master/sbt > /etc/sbt && \
        chmod 0755 /etc/sbt && \
        rm $WERCKER_CACHE_DIR/ivy/.sbt.ivy.lock && \
        /etc/sbt -v -ivy $WERCKER_CACHE_DIR/ivy -sbt-dir $WERCKER_CACHE_DIR/sbt -sbt-boot $WERCKER_CACHE_DIR/sbt-boot -sbt-launch-dir $WERCKER_CACHE_DIR/sbt-launch compile
    - internal/docker-push:
        username: $USERNAME
        password: $PASSWORD
        repository: piotrtrzpil/test-repo
        tag: test

build:
  steps:
  - script:
      name: pre build
      code: |
        curl -s https://raw.githubusercontent.com/paulp/sbt-extras/master/sbt > /etc/sbt && \
        chmod 0755 /etc/sbt && \
        yum makecache fast && \
        yum -y install tar
  - script:
      name: build release
      code: |
        /etc/sbt -v -ivy $WERCKER_CACHE_DIR/ivy -sbt-dir $WERCKER_CACHE_DIR/sbt -sbt-boot $WERCKER_CACHE_DIR/sbt-boot -sbt-launch-dir $WERCKER_CACHE_DIR/sbt-launch \
        clean universal:package-zip-tarball && \
        tar -xvzf target/universal/play-scala-1.0-SNAPSHOT.tgz -C target/universal/
## mv target/universal/play-scala-1.0-SNAPSHOT.tgz $WERCKER_OUTPUT_DIR/play-scala-1.0-SNAPSHOT.tgz
#  - internal/docker-push:
#      username: $USERNAME
#      password: $PASSWORD
#      repository: tray/test-repo
#      tag: test
deploy:
  box: tray/java:8-jre-new
  steps:
  - script:
      name: debug
      code: |
        echo $USERNAME
  - internal/docker-push:
      username: $USERNAME
      password: $DPASSWORD
      repository: tray/test-repo
      tag: master
      entrypoint: target/universal/play-scala-1.0-SNAPSHOT/bin/play-scala