#box: ingensi/play-framework:2.3.8
box: tray/sbt


#dev:
#  steps:
#    - script:
#      name: build release
#      code: |
#        curl -s https://raw.githubusercontent.com/paulp/sbt-extras/master/sbt > /etc/sbt && \
#        chmod 0755 /etc/sbt && \
#        rm $WERCKER_CACHE_DIR/ivy/.sbt.ivy.lock && \
#        /etc/sbt -v -ivy $WERCKER_CACHE_DIR/ivy -sbt-dir $WERCKER_CACHE_DIR/sbt -sbt-boot $WERCKER_CACHE_DIR/sbt-boot -sbt-launch-dir $WERCKER_CACHE_DIR/sbt-launch compile
#    - internal/docker-push:
#        username: $USERNAME
#        password: $PASSWORD
#        repository: piotrtrzpil/test-repo
#        tag: test

build:
  steps:
  - script:
      name: build release
      code: |
        sbt -v \
            -ivy $WERCKER_CACHE_DIR/ivy \
            -sbt-dir $WERCKER_CACHE_DIR/sbt \
            -sbt-boot $WERCKER_CACHE_DIR/sbt-boot \
            -sbt-launch-dir $WERCKER_CACHE_DIR/sbt-launch \
          clean universal:package-zip-tarball
        tar -xvzf target/universal/${WERCKER_GIT_REPOSITORY}-1.0-SNAPSHOT.tgz -C $WERCKER_OUTPUT_DIR/

deploy:
  box: tray/java:8-jre-new
  steps:
  - internal/docker-push:
      username: $USERNAME
      password: $DPASSWORD
      repository: piotrtrzpil/${WERCKER_GIT_REPOSITORY}
      tag: $WERCKER_GIT_BRANCH
      env: APP_VERSION=$WERCKER_GIT_COMMIT
      ports: 9000
      entrypoint: ${WERCKER_GIT_REPOSITORY}-1.0-SNAPSHOT/bin/${WERCKER_GIT_REPOSITORY}